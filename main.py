import telebot
from telebot import types
from gtts import gTTS
import os
import sqlite3
from threading import Lock, Thread
import time
from dotenv import load_dotenv  # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞—â–∏—Ç—ã

# --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–©–ò–¢–´ ---
load_dotenv()  # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ .env

TOKEN = os.getenv("BOT_TOKEN")
ADMIN_ID = int(os.getenv("ADMIN_ID")) if os.getenv("ADMIN_ID") else 0
ADMIN_NICK = "@Dbebrreuf"

if not TOKEN:
    print("‚ùå –û–®–ò–ë–ö–ê: –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ!")
    exit()

bot = telebot.TeleBot(TOKEN, threaded=True, num_threads=200)

db_lock = Lock()
user_data = {} 

if not os.path.exists('voice_cache'):
    os.makedirs('voice_cache')

# --- –ë–î ---
def init_db():
    with db_lock:
        conn = sqlite3.connect('gym_pro_users.db', check_same_thread=False)
        cursor = conn.cursor()
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS users (
                user_id INTEGER PRIMARY KEY,
                username TEXT,
                first_name TEXT,
                is_premium INTEGER DEFAULT 0,
                join_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        conn.commit()
        return conn, cursor

conn, cursor = init_db()

# --- –ë–ê–ó–ê –£–ü–†–ê–ñ–ù–ï–ù–ò–ô (–ë–ï–°–ü–õ–ê–¢–ù–´–ï) ---
WORKOUTS = {
    "–í–ï–†–• –¢–ï–õ–ê": [
        {"name": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è", "reps": "3 x 15", "desc": "–ì—Ä—É–¥—å –ø–æ—á—Ç–∏ –∫–∞—Å–∞–µ—Ç—Å—è –ø–æ–ª–∞, —Ç–µ–ª–æ —Ä–æ–≤–Ω–æ–µ."},
        {"name": "–û–±—Ä–∞—Ç–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è", "reps": "3 x 12", "desc": "–†—É–∫–∏ –Ω–∞ –æ–ø–æ—Ä–µ —Å–∑–∞–¥–∏, –ª–æ–∫—Ç–∏ –Ω–∞–∑–∞–¥."},
        {"name": "–®–∏—Ä–æ–∫–∏–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è", "reps": "3 x 12", "desc": "–†—É–∫–∏ —à–∏—Ä–µ –ø–ª–µ—á –¥–ª—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –≥—Ä—É–¥–∏."},
        {"name": "–ê–ª–º–∞–∑–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è", "reps": "3 x 10", "desc": "–õ–∞–¥–æ–Ω–∏ –±–ª–∏–∑–∫–æ, –æ–±—Ä–∞–∑—É—é—Ç —Ä–æ–º–±."},
        {"name": "–ü–ª–∞–Ω–∫–∞ –Ω–∞ –ª–æ–∫—Ç—è—Ö", "reps": "3 x 45 —Å–µ–∫", "desc": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∫–∞."}
    ],
    "–ù–û–ì–ò –ò –Ø–ì–û–î–ò–¶–´": [
        {"name": "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è", "reps": "4 x 20", "desc": "–ü—è—Ç–∫–∏ –Ω–∞ –ø–æ–ª—É, —Ç–∞–∑ –Ω–∞–∑–∞–¥."},
        {"name": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –≤—ã–ø–∞–¥—ã", "reps": "3 x 12", "desc": "–ö–æ–ª–µ–Ω–æ —Å–∑–∞–¥–∏ –ø–æ—á—Ç–∏ –¥–æ –ø–æ–ª–∞."},
        {"name": "–ë–æ–∫–æ–≤—ã–µ –≤—ã–ø–∞–¥—ã", "reps": "3 x 15", "desc": "–®–∞–≥ –≤ —Å—Ç–æ—Ä–æ–Ω—É, —Å–ø–∏–Ω–∞ –ø—Ä—è–º–∞—è."},
        {"name": "–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç–∏–∫", "reps": "3 x 20", "desc": "–í—ã—Ç–∞–ª–∫–∏–≤–∞–µ–º —Ç–∞–∑ –≤–≤–µ—Ä—Ö."},
        {"name": "–ü–æ–¥—ä–µ–º—ã –Ω–∞ –Ω–æ—Å–∫–∏", "reps": "3 x 25", "desc": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–æ–¥—ä–µ–º –≤–≤–µ—Ä—Ö."}
    ]
}

# --- –ü–†–û –ü–ò–¢–ê–ù–ò–ï (30 –î–ù–ï–ô) ---
PRO_DIET = {
    1: "üçè –î–µ–Ω—å 1: –û–≤—Å—è–Ω–∫–∞ + —è–π—Ü–∞. –û–±–µ–¥: –ö—É—Ä–∏—Ü–∞ + –ì—Ä–µ—á–∫–∞. –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥.",
    2: "üçè –î–µ–Ω—å 2: –û–º–ª–µ—Ç. –û–±–µ–¥: –†—ã–±–∞ + –†–∏—Å. –£–∂–∏–Ω: –°–∞–ª–∞—Ç —Å —Ç—É–Ω—Ü–æ–º.",
    3: "üçè –î–µ–Ω—å 3: –°—ã—Ä–Ω–∏–∫–∏. –û–±–µ–¥: –ò–Ω–¥–µ–π–∫–∞ + –ë—É–ª–≥—É—Ä. –£–∂–∏–Ω: –ö–µ—Ñ–∏—Ä.",
    4: "üçè –î–µ–Ω—å 4: –¢–æ—Å—Ç —Å –∞–≤–æ–∫–∞–¥–æ. –û–±–µ–¥: –ì–æ–≤—è–¥–∏–Ω–∞ + –ú–∞–∫–∞—Ä–æ–Ω—ã. –£–∂–∏–Ω: –û–º–ª–µ—Ç.",
    5: "üçè –î–µ–Ω—å 5: –ì—Ä–µ—á–∫–∞ —Å –º–æ–ª–æ–∫–æ–º. –û–±–µ–¥: –ö–æ—Ç–ª–µ—Ç—ã + –ö–∏–Ω–æ–∞. –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥.",
    6: "üçè –î–µ–Ω—å 6: –¢–≤–æ—Ä–æ–∂–Ω–∞—è –∑–∞–ø–µ–∫–∞–Ω–∫–∞. –û–±–µ–¥: –ì–æ—Ä–±—É—à–∞ + –û–≤–æ—â–∏. –£–∂–∏–Ω: –†—è–∂–µ–Ω–∫–∞.",
    7: "üçè –î–µ–Ω—å 7: –Ø–∏—á–Ω–∏—Ü–∞. –û–±–µ–¥: –ö—É—Ä–∏–Ω—ã–π —Å—É–ø. –£–∂–∏–Ω: –†—ã–±–∞ –Ω–∞ –ø–∞—Ä—É.",
    8: "üçè –î–µ–Ω—å 8: –ô–æ–≥—É—Ä—Ç + –ë–∞–Ω–∞–Ω. –û–±–µ–¥: –ü–ª–æ–≤ —Å –∏–Ω–¥–µ–π–∫–æ–π. –£–∂–∏–Ω: –°–∞–ª–∞—Ç.",
    9: "üçè –î–µ–Ω—å 9: –ú—é—Å–ª–∏. –û–±–µ–¥: –¢–µ–ª—è—Ç–∏–Ω–∞ + –ì—Ä–µ—á–∫–∞. –£–∂–∏–Ω: –Ø–π—Ü–∞.",
    10: "üçè –î–µ–Ω—å 10: –ö–∞—à–∞ –ø—à–µ–Ω–Ω–∞—è. –û–±–µ–¥: –ó–∞–ø–µ—á–µ–Ω–Ω—ã–π –º–∏–Ω—Ç–∞–π. –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥.",
    11: "üçè –î–µ–Ω—å 11: –¢–æ—Å—Ç —Å —Å—ã—Ä–æ–º. –û–±–µ–¥: –õ–∞–ø—à–∞ –∫—É—Ä–∏–Ω–∞—è. –£–∂–∏–Ω: –û–≤–æ—â–∏.",
    12: "üçè –î–µ–Ω—å 12: –ë–ª–∏–Ω—ã –æ–≤—Å—è–Ω—ã–µ. –û–±–µ–¥: –ò–Ω–¥–µ–π–∫–∞ –≤ –¥—É—Ö–æ–≤–∫–µ. –£–∂–∏–Ω: –ì—Ä—É–¥–∫–∞.",
    13: "üçè –î–µ–Ω—å 13: –û–º–ª–µ—Ç –±–µ–ª–∫–æ–≤—ã–π. –û–±–µ–¥: –õ–∞–∑–∞–Ω—å—è –ü–ü. –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥.",
    14: "üçè –î–µ–Ω—å 14: –¢–≤–æ—Ä–æ–≥ + –æ—Ä–µ—Ö–∏. –û–±–µ–¥: –ö—É—Ä–∏—Ü–∞ –¢–µ—Ä–∏—è–∫–∏. –£–∂–∏–Ω: –ö–µ—Ñ–∏—Ä.",
    15: "üçè –î–µ–Ω—å 15: –°–º—É–∑–∏ —Ñ—Ä—É–∫—Ç–æ–≤—ã–π. –û–±–µ–¥: –°—Ç–µ–π–∫ –≥–æ–≤—è–∂–∏–π. –£–∂–∏–Ω: –°–∞–ª–∞—Ç.",
    16: "üçè –î–µ–Ω—å 16: –¢–æ—Å—Ç —Å —Ç–≤–æ—Ä–æ–≥–æ–º. –û–±–µ–¥: –¢—Ä–µ—Å–∫–∞ + –ö–∞–ø—É—Å—Ç–∞. –£–∂–∏–Ω: –Ø–π—Ü–∞.",
    17: "üçè –î–µ–Ω—å 17: –ö–∞—à–∞ —è—á–Ω–µ–≤–∞—è. –û–±–µ–¥: –¢–µ—Ñ—Ç–µ–ª–∏ + –ë—É–ª–≥—É—Ä. –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥.",
    18: "üçè –î–µ–Ω—å 18: –ü–ü –ø–µ—á–µ–Ω—å–µ. –û–±–µ–¥: –ü–æ—Å—Ç–Ω—ã–π –±–æ—Ä—â. –£–∂–∏–Ω: –†—è–∂–µ–Ω–∫–∞.",
    19: "üçè –î–µ–Ω—å 19: –°—ã—Ä–Ω–∏–∫–∏. –û–±–µ–¥: –ò–Ω–¥–µ–π–∫–∞ + –ö–∏–Ω–æ–∞. –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥.",
    20: "üçè –î–µ–Ω—å 20: –û–º–ª–µ—Ç —à–ø–∏–Ω–∞—Ç. –û–±–µ–¥: –†—ã–±–Ω—ã–µ –∫–æ—Ç–ª–µ—Ç—ã. –£–∂–∏–Ω: –û–≤–æ—â–∏.",
    21: "üçè –î–µ–Ω—å 21: –ö–∞—à–∞ –∫—É–∫—É—Ä—É–∑–Ω–∞—è. –û–±–µ–¥: –°—Ç–µ–π–∫ –≥–æ–≤—è–∂–∏–π. –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥.",
    22: "üçè –î–µ–Ω—å 22: –†–∏—Å —Å –∫—É—Ä–∞–≥–æ–π. –û–±–µ–¥: –ß–µ—á–µ–≤–∏—á–Ω—ã–π —Å—É–ø. –£–∂–∏–Ω: –ú–∏–Ω—Ç–∞–π.",
    23: "üçè –î–µ–Ω—å 23: –ê—Ä–∞—Ö–∏—Å–æ–≤–∞—è –ø–∞—Å—Ç–∞. –û–±–µ–¥: –ö—É—Ä–∏—Ü–∞ + –û–≤–æ—â–∏. –£–∂–∏–Ω: –°–∞–ª–∞—Ç.",
    24: "üçè –î–µ–Ω—å 24: –Ø–∏—á–Ω–∏—Ü–∞ –≤–µ—Ç—á–∏–Ω–∞. –û–±–µ–¥: –ü–∞—Å—Ç–∞ —Ç–æ–º–∞—Ç–Ω–∞—è. –£–∂–∏–Ω: –†—è–∂–µ–Ω–∫–∞.",
    25: "üçè –î–µ–Ω—å 25: –Ø–±–ª–æ–∫–æ –ø–µ—á–µ–Ω–æ–µ. –û–±–µ–¥: –ü–ª–æ–≤ —Å –º—è—Å–æ–º. –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥.",
    26: "üçè –î–µ–Ω—å 26: –¢–≤–æ—Ä–æ–≥ –∏ —Ñ—É–Ω–¥—É–∫. –û–±–µ–¥: –£—Ö–∞ –∫—Ä–∞—Å–Ω–∞—è. –£–∂–∏–Ω: –ì—Ä—É–¥–∫–∞.",
    27: "üçè –î–µ–Ω—å 27: –ü–µ—Ä–ª–æ–≤–∫–∞. –û–±–µ–¥: –¢—É—à–µ–Ω–∞—è –∫–∞–ø—É—Å—Ç–∞. –£–∂–∏–Ω: –†—è–∂–µ–Ω–∫–∞.",
    28: "üçè –î–µ–Ω—å 28: –§—Ä—É–∫—Ç—ã. –û–±–µ–¥: –†–∏—Å + –ù—É—Ç. –£–∂–∏–Ω: –°–∞–ª–∞—Ç —è–∏—á–Ω—ã–π.",
    29: "üçè –î–µ–Ω—å 29: –°—ã—Ä–Ω–∏–∫–∏. –û–±–µ–¥: –†—ã–±–Ω—ã–π –ø–∏—Ä–æ–≥ –ü–ü. –£–∂–∏–Ω: –ö–µ—Ñ–∏—Ä.",
    30: "üçè –î–µ–Ω—å 30: –ì—Ä—É–¥–∫–∞ + –†–∏—Å + –ó–µ–ª–µ–Ω—å. –£–∂–∏–Ω: –¢–≤–æ—Ä–æ–≥ 2%."
}

# --- –ü–†–û –¢–†–ï–ù–ò–†–û–í–ö–ò (50 –î–ù–ï–ô) ---
PRO_WORK = {
    1: "üí™ –î–µ–Ω—å 1: 50 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π, 30 –æ—Ç–∂–∏–º–∞–Ω–∏–π, 2 –º–∏–Ω –ø–ª–∞–Ω–∫–∏.",
    2: "üí™ –î–µ–Ω—å 2: 40 –≤—ã–ø–∞–¥–æ–≤, 20 –æ–±—Ä–∞—Ç–Ω—ã—Ö –æ—Ç–∂–∏–º–∞–Ω–∏–π, 50 –ø—Ä–µ—Å—Å.",
    3: "üí™ –î–µ–Ω—å 3: –ê–∫—Ç–∏–≤–Ω–∞—è —Ö–æ–¥—å–±–∞ 5–∫–º + —Ä–∞—Å—Ç—è–∂–∫–∞.",
    4: "üí™ –î–µ–Ω—å 4: 5 –∫—Ä—É–≥–æ–≤: 15 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π, 15 –æ—Ç–∂–∏–º–∞–Ω–∏–π, 30 —Å–µ–∫ —Å–∫–∞–ª–æ–ª–∞–∑.",
    5: "üí™ –î–µ–Ω—å 5: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–ª–∞–Ω–∫–∞ (3 –ø–æ–¥—Ö–æ–¥–∞) + 40 –±–µ—Ä–ø–∏.",
    6: "üí™ –î–µ–Ω—å 6: –ö—Ä—É–≥–æ–≤–∞—è: –≤—ã–ø—Ä—ã–≥–∏–≤–∞–Ω–∏—è (20), –∞–ª–º–∞–∑–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è (10) - 4 –∫—Ä—É–≥–∞.",
    7: "üí™ –î–µ–Ω—å 7: –ü–û–õ–ù–´–ô –û–¢–î–´–•.",
    8: "üí™ –î–µ–Ω—å 8: 20 —à–∏—Ä–æ–∫–∏—Ö –æ—Ç–∂–∏–º–∞–Ω–∏–π, 30 —è–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç–∏–∫, 20 –ø–æ–¥—ä–µ–º–æ–≤ –Ω–æ–≥.",
    9: "üí™ –î–µ–Ω—å 9: 10 –º–∏–Ω—É—Ç –±–µ–≥–∞ –Ω–∞ –º–µ—Å—Ç–µ + 50 –¥–∂–∞–º–ø–∏–Ω–≥-–¥–∂–µ–∫–æ–≤.",
    10: "üí™ –î–µ–Ω—å 10: –°—Ç—É–ª—å—á–∏–∫ —É —Å—Ç–µ–Ω—ã 3—Ö45 —Å–µ–∫ + 30 –æ—Ç–∂–∏–º–∞–Ω–∏–π.",
    11: "üí™ –î–µ–Ω—å 11: 4 –∫—Ä—É–≥–∞: 20 –≤—ã–ø–∞–¥–æ–≤, 15 –æ–±—Ä–∞—Ç–Ω—ã—Ö –æ—Ç–∂–∏–º–∞–Ω–∏–π, 20 –ø—Ä–µ—Å—Å.",
    12: "üí™ –î–µ–Ω—å 12: –ë–æ–∫–æ–≤–∞—è –ø–ª–∞–Ω–∫–∞ –ø–æ 1 –º–∏–Ω –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—É + 50 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π.",
    13: "üí™ –î–µ–Ω—å 13: 50 –æ—Ç–∂–∏–º–∞–Ω–∏–π (–∑–∞ –º–∞–∫—Å –≤—Ä–µ–º—è) + 100 —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–π.",
    14: "üí™ –î–µ–Ω—å 14: –†–∞—Å—Ç—è–∂–∫–∞ –≤—Å–µ–≥–æ —Ç–µ–ª–∞ 20 –º–∏–Ω—É—Ç.",
    15: "üí™ –î–µ–Ω—å 15: –¢–ï–°–¢: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è (–º–∞–∫—Å), –û—Ç–∂–∏–º–∞–Ω–∏—è (–º–∞–∫—Å).",
    16: "üî• –î–µ–Ω—å 16: –í–∑—Ä—ã–≤–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è 4—Ö10 + –ø—Ä—ã–∂–∫–∏ –∏–∑ –ø—Ä–∏—Å–µ–¥–∞ 4—Ö15.",
    17: "üî• –î–µ–Ω—å 17: V-–æ–±—Ä–∞–∑–Ω—ã–µ –ø–æ–¥—ä–µ–º—ã –Ω–∞ –ø—Ä–µ—Å—Å 3—Ö15 + –ø–ª–∞–Ω–∫–∞ 2 –º–∏–Ω.",
    18: "üî• –î–µ–Ω—å 18: –ü—Ä–æ–≥—É–ª–∫–∞ –±—ã—Å—Ç—Ä—ã–º —à–∞–≥–æ–º 40 –º–∏–Ω—É—Ç.",
    19: "üî• –î–µ–Ω—å 19: 5 –∫—Ä—É–≥–æ–≤: 10 –±–µ—Ä–ø–∏ + 20 –≤—ã–ø–∞–¥–æ–≤ + 15 —É–∑–∫–∏—Ö –æ—Ç–∂–∏–º–∞–Ω–∏–π.",
    20: "üî• –î–µ–Ω—å 20: –ë–æ–ª–≥–∞—Ä—Å–∫–∏–µ –≤—ã–ø–∞–¥—ã 4—Ö12 + —Å—É–ø–µ—Ä–º–µ–Ω 4—Ö15.",
    21: "üî• –î–µ–Ω—å 21: –ò–Ω–¥–∏–π—Å–∫–∏–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è 3—Ö12 + —Ä—É—Å—Å–∫–∏–π —Ç–≤–∏—Å—Ç 3—Ö40.",
    22: "üî• –î–µ–Ω—å 22: 6 –∫—Ä—É–≥–æ–≤: 30 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π, 20 –æ—Ç–∂–∏–º–∞–Ω–∏–π, 20 —Å–µ–∫ –±–µ–≥ –Ω–∞ –º–µ—Å—Ç–µ.",
    23: "üî• –î–µ–Ω—å 23: –°—Ç–∞—Ç–∏–∫–∞: –°—Ç—É–ª—å—á–∏–∫ 1 –º–∏–Ω + –ü–ª–∞–Ω–∫–∞ 1 –º–∏–Ω + –õ–æ–¥–æ—á–∫–∞ 1 –º–∏–Ω (3 —Å–µ—Ç–∞).",
    24: "üî• –î–µ–Ω—å 24: –°–∫–∞–ª–æ–ª–∞–∑ 4—Ö1 –º–∏–Ω + –ë–µ—Ä–ø–∏ 4—Ö10.",
    25: "üî• –î–µ–Ω—å 25: –≠–ö–í–ê–¢–û–†: 100 –æ—Ç–∂–∏–º–∞–Ω–∏–π –∏ 200 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π –∑–∞ –¥–µ–Ω—å.",
    26: "üî• –î–µ–Ω—å 26: –û—Ç–¥—ã—Ö + –ª–µ–≥–∫–∞—è —Ä–∞—Å—Ç—è–∂–∫–∞.",
    27: "üî• –î–µ–Ω—å 27: –ê–ª–º–∞–∑–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è 4—Ö15 + –æ–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–ø–∞–¥—ã 4—Ö20.",
    28: "üî• –î–µ–Ω—å 28: –ü–ª–∞–Ω–∫–∞ —Å –ø—Ä—ã–∂–∫–æ–º 3—Ö20 + –ø–æ–¥—ä–µ–º –Ω–æ–≥ –ª–µ–∂–∞ 3—Ö20.",
    29: "üî• –î–µ–Ω—å 29: –¢–∞–±–∞—Ç–∞: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è (20 —Å–µ–∫ —Ä–∞–±–æ—Ç–∞ / 10 —Å–µ–∫ –æ—Ç–¥—ã—Ö).",
    30: "üî• –î–µ–Ω—å 30: –¢–∞–±–∞—Ç–∞: –û—Ç–∂–∏–º–∞–Ω–∏—è.",
    31: "üî• –î–µ–Ω—å 31: –í—ã–ø–∞–¥—ã –≤ –ø—Ä—ã–∂–∫–µ 3—Ö20 + –æ—Ç–∂–∏–º–∞–Ω–∏—è –Ω–∞ –∫—É–ª–∞–∫–∞—Ö 3—Ö15.",
    32: "üî• –î–µ–Ω—å 32: –ü—Ä–µ—Å—Å: –ù–æ–∂–Ω–∏—Ü—ã 1 –º–∏–Ω + –í–µ–ª–æ—Å–∏–ø–µ–¥ 1 –º–∏–Ω + –ü–ª–∞–Ω–∫–∞ 1 –º–∏–Ω.",
    33: "üî• –î–µ–Ω—å 33: –ó–∞–±–µ–≥ –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ 10 –º–∏–Ω + —Ä–∞—Å—Ç—è–∂–∫–∞.",
    34: "üî• –î–µ–Ω—å 34: 5 —Å–µ—Ç–æ–≤: 15 —à–∏—Ä–æ–∫–∏—Ö –æ—Ç–∂–∏–º–∞–Ω–∏–π + 15 –≤—ã–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–π.",
    35: "üî• –î–µ–Ω—å 35: –ú–∞–∫—Å–∏–º—É–º –±–µ—Ä–ø–∏ –∑–∞ 5 –º–∏–Ω—É—Ç.",
    36: "üöÄ –î–µ–Ω—å 36: –°–£–ü–ï–†–°–ï–¢: –û—Ç–∂–∏–º–∞–Ω–∏—è (–º–∞–∫—Å) + –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è (–º–∞–∫—Å) - 4 –∫—Ä—É–≥–∞.",
    37: "üöÄ –î–µ–Ω—å 37: 100 —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–π + 50 –æ–±—Ä–∞—Ç–Ω—ã—Ö –æ—Ç–∂–∏–º–∞–Ω–∏–π.",
    38: "üöÄ –î–µ–Ω—å 38: –ü–ª–∞–Ω–∫–∞ '–ø–∞—É–∫' 4—Ö20 + –±–æ–∫–æ–≤—ã–µ –≤—ã–ø–∞–¥—ã 4—Ö20.",
    39: "üöÄ –î–µ–Ω—å 39: –ü–û–õ–ù–´–ô –û–¢–î–´–•.",
    40: "üöÄ –î–µ–Ω—å 40: 10 –∫—Ä—É–≥–æ–≤: 5 –±–µ—Ä–ø–∏, 10 –æ—Ç–∂–∏–º–∞–Ω–∏–π, 15 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π.",
    41: "üöÄ –î–µ–Ω—å 41: –°–µ—Ç –Ω–∞ –ø—Ä–µ—Å—Å: –ü–æ–¥—ä–µ–º –Ω–æ–≥ + –¢–≤–∏—Å—Ç + –ü–ª–∞–Ω–∫–∞ (4 –∫—Ä—É–≥–∞).",
    42: "üöÄ –î–µ–Ω—å 42: –ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è –ø–ª–∏–µ 4—Ö30 + –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è 4—Ö15.",
    43: "üöÄ –î–µ–Ω—å 43: –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ –∫–∞—Ä–¥–∏–æ 30 –º–∏–Ω (–±–µ–≥ –∏–ª–∏ –ø—Ä—ã–∂–∫–∏).",
    44: "üöÄ –î–µ–Ω—å 44: '–õ–µ—Å–µ–Ω–∫–∞' –æ—Ç–∂–∏–º–∞–Ω–∏–π: –æ—Ç 1 –¥–æ 10 –∏ –æ–±—Ä–∞—Ç–Ω–æ.",
    45: "üöÄ –î–µ–Ω—å 45: –°—Ç—É–ª—å—á–∏–∫ —É —Å—Ç–µ–Ω—ã (–º–∞–∫—Å –≤—Ä–µ–º—è) + –°—É–ø–µ—Ä–º–µ–Ω 4—Ö20.",
    46: "üöÄ –î–µ–Ω—å 46: 50 –≤—ã–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–π + 50 –∞–ª–º–∞–∑–Ω—ã—Ö –æ—Ç–∂–∏–º–∞–Ω–∏–π.",
    47: "üöÄ –î–µ–Ω—å 47: –ü–ª–∞–Ω–∫–∞ –Ω–∞ –æ–¥–Ω–æ–π —Ä—É–∫–µ (–ø–æ 30 —Å–µ–∫) + –°–∫–∞–ª–æ–ª–∞–∑ (2 –º–∏–Ω).",
    48: "üöÄ –î–µ–Ω—å 48: 100 –≤—ã–ø–∞–¥–æ–≤ + 100 –ø–æ–¥—ä–µ–º–æ–≤ –Ω–∞ –Ω–æ—Å–∫–∏.",
    49: "üöÄ –î–µ–Ω—å 49: –†–∞—Å—Ç—è–∂–∫–∞ –≤—Å–µ–≥–æ —Ç–µ–ª–∞.",
    50: "üèÜ –î–µ–Ω—å 50: –§–ò–ù–ê–õ: 100 –æ—Ç–∂–∏–º–∞–Ω–∏–π, 100 –ø—Ä–µ—Å—Å–∞, 100 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π, 5 –º–∏–Ω –ø–ª–∞–Ω–∫–∏!"
}

# --- –§–£–ù–ö–¶–ò–ò ---
def pre_generate_voices():
    print("üéô –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∑–≤—É—á–∫–∏...")
    for cat in WORKOUTS:
        for ex in WORKOUTS[cat]:
            safe_name = "".join([c for c in ex['name'] if c.isalnum()])
            path = f"voice_cache/{safe_name}.mp3"
            if not os.path.exists(path):
                try: gTTS(text=f"{ex['name']}. –¶–µ–ª—å {ex['reps']}", lang='ru').save(path)
                except: pass

def init_user(uid):
    if uid not in user_data:
        user_data[uid] = {'plan': [], 'idx': 0, 'theme': 'dark'}
    return user_data[uid]

def get_main_kb():
    m = types.ReplyKeyboardMarkup(resize_keyboard=True)
    m.row("–í–ï–†–• –¢–ï–õ–ê", "–ù–û–ì–ò –ò –Ø–ì–û–î–ò–¶–´") 
    m.row("üî• –ü–†–ï–ú–Ü–£–ú –ö–£–†–° (120 –≥—Ä–Ω)")   
    m.row("ü•ó –ì–ê–ô–î –ü–û –ü–ò–¢–ê–ù–ò–Æ", "üåì –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É") 
    m.row("‚òïÔ∏è –ü–û–î–î–ï–†–ñ–ê–¢–¨ –ê–í–¢–û–†–ê") # –û–ù–ê –ó–î–ï–°–¨!
    return m

# --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ---
@bot.message_handler(commands=['start'])
def start(message):
    uid = message.from_user.id
    with db_lock:
        cursor.execute('INSERT OR IGNORE INTO users (user_id, username, first_name) VALUES (?, ?, ?)', 
                       (uid, message.from_user.username, message.from_user.first_name))
        conn.commit()
    init_user(uid)
    bot.send_message(message.chat.id, "üöÄ –ë–æ—Ç GYM PRO –∑–∞—â–∏—â–µ–Ω –∏ –≥–æ—Ç–æ–≤!", reply_markup=get_main_kb())

def send_exercise(chat_id, uid):
    data = user_data.get(uid)
    if not data or data['idx'] >= len(data['plan']):
        bot.send_message(chat_id, "üéâ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!", reply_markup=get_main_kb())
        return
    ex = data['plan'][data['idx']]
    
    def handle_voice():
        safe_name = "".join([c for c in ex['name'] if c.isalnum()])
        path = f"voice_cache/{safe_name}.mp3"
        if os.path.exists(path):
            with open(path, 'rb') as v: bot.send_voice(chat_id, v)

    Thread(target=handle_voice).start()
    header = "üåë [DARK]" if data['theme'] == 'dark' else "‚òÄÔ∏è [LIGHT]"
    caption = f"{header}\n\nüî• *{ex['name']}*\nüéØ {ex['reps']}\n\nüìù {ex['desc']}"
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("‚úÖ –î–ê–õ–¨–®–ï", callback_data="next_step"))
    bot.send_message(chat_id, caption, parse_mode="Markdown", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data == "next_step")
def next_step(call):
    uid = call.from_user.id
    if uid in user_data:
        user_data[uid]['idx'] += 1
        try: bot.delete_message(call.message.chat.id, call.message.message_id)
        except: pass
        send_exercise(call.message.chat.id, uid)

@bot.message_handler(func=lambda message: message.text == "üî• –ü–†–ï–ú–Ü–£–ú –ö–£–†–° (120 –≥—Ä–Ω)")
def premium_menu(message):
    uid = message.from_user.id
    with sqlite3.connect('gym_pro_users.db') as c:
        res = c.execute('SELECT is_premium FROM users WHERE user_id = ?', (uid,)).fetchone()
    
    if res and res[0] == 1:
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        markup.add("üèÉ‚Äç‚ôÇÔ∏è –¢–†–ï–ù–£–í–ê–ù–ù–Ø (50 –î–ù–Ü–í)", "üçè –•–ê–†–ß–£–í–ê–ù–ù–Ø (30 –î–ù–Ü–í)")
        markup.add("‚òïÔ∏è –ü–û–î–î–ï–†–ñ–ê–¢–¨ –ê–í–¢–û–†–ê", "‚¨ÖÔ∏è –ù–ê–ó–ê–î")
        bot.send_message(message.chat.id, "üåü **–í–∞—à –ü—Ä–µ–º—ñ—É–º-–∫–∞–±–∏–Ω–µ—Ç!**", reply_markup=markup, parse_mode="Markdown")
    else:
        info_text = (
            "üöÄ **–ü–†–ï–ú–Ü–£–ú –ö–£–†–°: –¢–†–ê–ù–°–§–û–†–ú–ê–¶–Ü–Ø**\n\n"
            "üí≥ **–û–ø–ª–∞—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç—É:**\n`4102321251250550`\n\n"
            "üì∏ **–ü–†–ò–®–õ–ò–¢–ï –°–ö–†–ò–ù–®–û–¢ –û–ü–õ–ê–¢–´ –°–Æ–î–ê**\n"
            "–í–∞—à ID: `{}`"
        ).format(uid)
        bot.send_message(message.chat.id, info_text, parse_mode="Markdown")

@bot.message_handler(func=lambda message: message.text == "‚òïÔ∏è –ü–û–î–î–ï–†–ñ–ê–¢–¨ –ê–í–¢–û–†–ê")
def support_author(message):
    support_text = (
        "‚òïÔ∏è **–ü–û–î–î–ï–†–ñ–ö–ê –ü–†–û–ï–ö–¢–ê**\n\n"
        "–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –±–æ—Ç –∏ —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–º–æ—á—å –≤ –µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏–∏, —Ç—ã –º–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ª—é–±—É—é —Å—É–º–º—É –∞–≤—Ç–æ—Ä—É.\n\n"
        "üí≥ **–ö–∞—Ä—Ç–∞ –¥–ª—è –¥–æ–Ω–∞—Ç–∞:**\n`4102321251250550`\n\n"
        "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—Ä–µ–Ω–∏—Ä—É–µ—à—å—Å—è —Å –Ω–∞–º–∏! üí™"
    )
    bot.send_message(message.chat.id, support_text, parse_mode="Markdown")

@bot.message_handler(content_types=['photo'])
def handle_payment(message):
    uid = message.from_user.id
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("‚úÖ –í–´–î–ê–¢–¨ –ü–†–ï–ú", callback_data=f"adm_give_{uid}"))
    bot.send_photo(ADMIN_ID, message.photo[-1].file_id, caption=f"üí∞ –ß–ï–ö –æ—Ç {uid}", reply_markup=markup)
    bot.reply_to(message, "‚è≥ –ß–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!")

@bot.callback_query_handler(func=lambda call: call.data.startswith("adm_give_"))
def admin_action(call):
    if call.from_user.id != ADMIN_ID: return
    target_id = int(call.data.split("_")[2])
    with sqlite3.connect('gym_pro_users.db') as c:
        c.execute('UPDATE users SET is_premium = 1 WHERE user_id = ?', (target_id,))
    bot.send_message(target_id, "üéâ –ü–†–ï–ú–ò–£–ú –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!")
    bot.answer_callback_query(call.id, "–í—ã–¥–∞–Ω–æ!")

@bot.message_handler(func=lambda message: message.text == "üèÉ‚Äç‚ôÇÔ∏è –¢–†–ï–ù–£–í–ê–ù–ù–Ø (50 –î–ù–Ü–í)")
def prem_work(message):
    uid = message.from_user.id
    with sqlite3.connect('gym_pro_users.db') as c:
        res = c.execute('SELECT is_premium FROM users WHERE user_id = ?', (uid,)).fetchone()
    if res and res[0] == 1:
        for i in range(1, 51, 10):
            chunk = "\n\n".join([PRO_WORK[j] for j in range(i, min(i+10, 51))])
            bot.send_message(message.chat.id, chunk)
            time.sleep(0.3)
    else: bot.send_message(message.chat.id, "üîí –î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç.")

@bot.message_handler(func=lambda message: message.text == "üçè –•–ê–†–ß–£–í–ê–ù–ù–Ø (30 –î–ù–Ü–í)")
def prem_nutr(message):
    uid = message.from_user.id
    with sqlite3.connect('gym_pro_users.db') as c:
        res = c.execute('SELECT is_premium FROM users WHERE user_id = ?', (uid,)).fetchone()
    if res and res[0] == 1:
        for i in range(1, 31, 10):
            chunk = "\n\n".join([PRO_DIET[j] for j in range(i, min(i+10, 31))])
            bot.send_message(message.chat.id, chunk)
            time.sleep(0.3)
    else: bot.send_message(message.chat.id, "üîí –î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç.")

@bot.message_handler(func=lambda message: message.text in WORKOUTS.keys())
def start_w(message):
    uid = message.from_user.id
    d = init_user(uid)
    d['plan'], d['idx'] = WORKOUTS[message.text], 0
    send_exercise(message.chat.id, uid)

@bot.message_handler(func=lambda message: message.text == "üåì –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É")
def theme(message):
    d = init_user(message.from_user.id)
    d['theme'] = 'light' if d['theme'] == 'dark' else 'dark'
    bot.reply_to(message, "‚úÖ –¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞!")

@bot.message_handler(func=lambda message: message.text == "‚¨ÖÔ∏è –ù–ê–ó–ê–î")
def back(message): start(message)

if __name__ == "__main__":
    pre_generate_voices()
    print("üöÄ –ë–û–¢ –ó–ê–ü–£–©–ï–ù –ò –ó–ê–©–ò–©–ï–ù!")
    
    while True:
        try:
            bot.polling(none_stop=True, interval=0, timeout=20)
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: {e}. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥...")
            time.sleep(5)

